defaults:
  - dataset: fiqa
  - templates: default
  - dl_sampler: none
  - model: ranker
  - tokenizer: default
  - trainer: default
  - benchmark: default
  - resources: default
  - batch_size: default
  - fabric: default
  - sys: default
  - hydra: default
  - env: default
  # enable color logging
  - override hydra/hydra_logging: colorlog
  - override hydra/job_logging: colorlog

seed: ${global_seed:}
model_name: ${model.encoder.pretrained_model_name_or_path}
exp_version: "v3.0"
exp_suffix: ""
exp_name: retrieval
run_name: ${fmt_mn:${model_name}}--${rdn_name:}-${exp_version}${exp_suffix}
load_from: null

dataloaders:
  # Defines the configurations for `torch.utils.data.Dataloader`
  train:
    batch_size: ${batch_size.per_device}
    num_workers: ${resources.num_workers}
    pin_memory: True
    shuffle: True
  eval:
    batch_size: ${batch_size.per_device_eval}
    num_workers: ${resources.num_workers}
    pin_memory: True
    shuffle: True
  benchmark:
    batch_size: ${batch_size.per_device_eval}
    num_workers: ${resources.num_workers}
    pin_memory: True
    shuffle: True
  predict:
    batch_size: ${batch_size.per_device_predict}
    num_workers: ${resources.num_workers}
    pin_memory: True
    shuffle: False

collates:
  # Defines the configurations for `dataset_builder.HfBuilder._collate_config`
  predict:
    encoder_max_length: 200 # Maximum length of the encoder input
    templates: ${templates} # Templates for the encoder input
  train:
    # Configuration for the training/evaluation `Collate`
    n_sections: 32 # Number of sections for each query
    max_pos_sections: 8 # Maximum number of positive sections for each query
    support_size: 100 # Maximum number of sections to sample from
    prefetch_n_sections: 128 # Number of sections to fetch from each search service
    do_sample: true # Whether to sample or use the top-k sections
    in_batch_negatives: false # Whether to share sections across all queries in a batch
    encoder_max_length: ${collates.predict.encoder_max_length}
    templates: ${templates}
  benchmark:
    # Configuration for the benchmark eval. `Collate`
    n_sections: null
    max_pos_sections: null
    support_size: null
    prefetch_n_sections: 300
    do_sample: false
    in_batch_negatives: false
    prep_num_proc: ${resources.num_proc}
    encoder_max_length: ${collates.predict.encoder_max_length}
    templates: ${templates}
